<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fencing Hub - Rankings</title>
    <link rel="stylesheet" href="/Static/styles.css">
    <link rel="icon" type="image/png" href="Static/Images/Logos/Logo.png">
</head>
<body id="rankings-page" style="background: linear-gradient(135deg, #0088a9, #24252A);"></body>
    {% block content %}
    <nav class="navbar">
        <img src="Static/Images/Logos/Logo_removed.png" alt="Logo" class="logo-img">
        <ul class="menu">
            <li><a href="/home">Home</a></li>
            <li><a href="/rankings">Rankings</a></li>
            <li><a href="/calendar">Calendar</a></li>
            <li class="dropdown">
                <a href="#">Information ‚ñº</a>
                <div class="dropdown-content">
                    <a href="/about_fencing">About Fencing</a>
                    <a href="/stories">Stories</a>
                    <a href="/about_us">About Us</a>
                </div>
            </li>
        </ul>
        <div class="btns">
            <button onclick="window.location.href='/login'">üë§Log In</button>
        </div>
    </nav>
    <main class="main_container">
        <h1>Rankings & Athletes</h1>
        <div class="selectors">
            <div class="selector-group">
                <div class="selector-label">Weapon</div>
                <div id="weaponSelector">
                    <label for="epee"><input type="radio" name="weapon" id="epee" value="epee" onchange="filterRankings()" checked> √âp√©e</label>
                    <label for="foil"><input type="radio" name="weapon" id="foil" value="foil" onchange="filterRankings()"> Foil</label>
                    <label for="sabre"><input type="radio" name="weapon" id="sabre" value="sabre" onchange="filterRankings()"> Sabre</label>
                </div>
            </div>
            <div class="vertical-line"></div>
            <div class="selector-group">
                <div class="selector-label">Gender</div>
                <div id="genderSelector">
                    <label for="male"><input type="radio" name="gender" id="male" value="male" onchange="filterRankings()" checked> Male</label>
                    <label for="female"><input type="radio" name="gender" id="female" value="female" onchange="filterRankings()"> Female</label>
                </div>
            </div>
            <div class="vertical-line"></div>
            <div class="selector-group">
                <div class="selector-label">Search</div>
                <input type="text" id="searchInput" onkeyup="filterRankings()" placeholder="Search for a Fencer...">
            </div>
        </div>
        <section class="leaderboard">
            {% if male_fencers|length > 0 %}
            <div id="leader2" class="leader">
                <div class="details">
                    <h2>2</h2>
                    <h3>Fencer 2</h3>
                    <p>Nationality</p>
                </div>
            </div>
            {% endif %}
            {% if male_fencers|length > 1 %}
            <div id="leader1" class="leader">
                <div class="details">
                    <h2>1</h2>
                    <h3>Fencer 1</h3>
                    <p>Nationality</p>
                </div>
            </div>
            {% endif %}
            {% if male_fencers|length > 2 %}
            <div id="leader3" class="leader">
                <div class="details">
                    <h2>3</h3>
                    <h3>Fencer 3</h3>
                    <p>Nationality</p>
                </div>
            </div>
            {% endif %}
        </section>
        <section class="container">
            <table id="rankingsTable">
                <thead>
                    <tr>
                        <th>Rank</th>
                        <th>Name</th>
                        <th>Nationality</th>
                        <th>Weapon</th>
                        <th>Gender</th>
                        <th>Hand</th>
                        <th>Age</th>
                    </tr>
                </thead>
                <tbody>
                    {% for fencer in Mepee %}
                    <tr data-weapon="epee" data-gender="male">
                        <td>{{ fencer[11] }}</td>
                        <td>{{ fencer[1] }} {{ fencer[2] }}</td>
                        <td>{{ fencer[4] }}</td>
                        <td>√âp√©e</td>
                        <td>{{ fencer[6] }}</td>
                        <td>{{ fencer[10] }}</td>
                        <td>{{ fencer[7] }}</td>
                    </tr>
                    {% endfor %}
                    {% for fencer in Mfoil %}
                    <tr data-weapon="foil" data-gender="male">
                        <td>{{ fencer[11] }}</td>
                        <td>{{ fencer[1] }} {{ fencer[2] }}</td>
                        <td>{{ fencer[4] }}</td>
                        <td>{{ fencer[9] }}</td>
                        <td>{{ fencer[6] }}</td>
                        <td>{{ fencer[10] }}</td>
                        <td>{{ fencer[7] }}</td>
                    </tr>
                    {% endfor %}
                    {% for fencer in Msabre %}
                    <tr data-weapon="sabre" data-gender="male">
                        <td>{{ fencer[11] }}</td>
                        <td>{{ fencer[1] }} {{ fencer[2] }}</td>
                        <td>{{ fencer[4] }}</td>
                        <td>{{ fencer[9] }}</td>
                        <td>{{ fencer[6] }}</td>
                        <td>{{ fencer[10] }}</td>
                        <td>{{ fencer[7] }}</td>
                    </tr>
                    {% endfor %}
                    {% for fencer in Fepee %}
                    <tr data-weapon="epee" data-gender="female">
                        <td>{{ fencer[11] }}</td>
                        <td>{{ fencer[1] }} {{ fencer[2] }}</td>
                        <td>{{ fencer[4] }}</td>
                        <td>√âp√©e</td>
                        <td>{{ fencer[6] }}</td>
                        <td>{{ fencer[10] }}</td>
                        <td>{{ fencer[7] }}</td>
                    </tr>
                    {% endfor %}
                    {% for fencer in Ffoil %}
                    <tr data-weapon="foil" data-gender="female">
                        <td>{{ fencer[11] }}</td>
                        <td>{{ fencer[1] }} {{ fencer[2] }}</td>
                        <td>{{ fencer[4] }}</td>
                        <td>{{ fencer[9] }}</td>
                        <td>{{ fencer[6] }}</td>
                        <td>{{ fencer[10] }}</td>
                        <td>{{ fencer[7] }}</td>
                    </tr>
                    {% endfor %}
                    {% for fencer in Fsabre %}
                    <tr data-weapon="sabre" data-gender="female">
                        <td>{{ fencer[11] }}</td>
                        <td>{{ fencer[1] }} {{ fencer[2] }}</td>
                        <td>{{ fencer[4] }}</td>
                        <td>{{ fencer[9] }}</td>
                        <td>{{ fencer[6] }}</td>
                        <td>{{ fencer[10] }}</td>
                        <td>{{ fencer[7] }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            <div class="pagination">
                <button id="prevPage" onclick="prevPage()" disabled>&laquo; Previous</button>
                <button id="nextPage" onclick="nextPage()">Next &raquo;</button>
            </div>            
            </section>
            </main>
            <footer>
            <ul>
            <li>&copy; 2024 Fencing Hub. All rights reserved.</li>
            </ul>
            <div class="social-media">
            <a href="#"><img src="Static/Images/Logos/Facebook.png" alt="Facebook"></a>
            <a href="#"><img src="Static/Images/Logos/X.png" alt="Twitter"></a>
            <a href="#"><img src="Static/Images/Logos/Insta.png" alt="Instagram"></a>
            </div>
            </footer>
        </section>
    </main>
    <script>
        function filterRankings() {
            const selectedWeapon = document.querySelector('#weaponSelector input:checked').value;
            const selectedGender = document.querySelector('#genderSelector input:checked').value;
            const searchQuery = document.getElementById('searchInput').value.toLowerCase();

            const table = document.getElementById('rankingsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const filteredRows = [];

            for (let row of rows) {
                const weapon = row.getAttribute('data-weapon');
                const gender = row.getAttribute('data-gender');
                const name = row.getElementsByTagName('td')[1].textContent.toLowerCase();

                if (weapon === selectedWeapon && gender === selectedGender && name.includes(searchQuery)) {
                    filteredRows.push(row);
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            }

            // Update leaderboards as per the filtered rows
            updateLeaderboard(filteredRows);
        }

        window.onload = function() {
            paginateTable();
            filterRankings(); // Call filterRankings() after pagination to show filtered rows
        };

        function updateLeaderboard(filteredRows) {
            const leader1 = document.getElementById('leader1');
            const leader2 = document.getElementById('leader2');
            const leader3 = document.getElementById('leader3');

            function updateLeader(leader, row) {
                const cells = row.getElementsByTagName('td');
                leader.querySelector('h3').textContent = `${cells[1].textContent}`;
                leader.querySelector('p').textContent = `${cells[2].textContent}`;
            }

            if (filteredRows.length > 0) {
                updateLeader(leader1, filteredRows[0]);
                leader1.style.display = 'block';
            } else {
                leader1.style.display = 'none';
            }

            if (filteredRows.length > 1) {
                updateLeader(leader2, filteredRows[1]);
                leader2.style.display = 'block';
            } else {
                leader2.style.display = 'none';
            }

            if (filteredRows.length > 2) {
                updateLeader(leader3, filteredRows[2]);
                leader3.style.display = 'block';
            } else {
                leader3.style.display = 'none';
            }
        }
        
        const rowsPerPage = 10;
        let currentPage = 1;

        function paginateTable() {
            const table = document.getElementById('rankingsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const totalRows = rows.length;
            const totalPages = Math.ceil(totalRows / rowsPerPage);

            // Hide all rows
            for (let i = 0; i < totalRows; i++) {
                rows[i].style.display = 'none';
            }

            // Show rows for the current page
            const start = (currentPage - 1) * rowsPerPage;
            const end = Math.min(start + rowsPerPage, totalRows);
            for (let i = start; i < end; i++) {
                rows[i].style.display = '';
            }

            // Enable/disable pagination buttons
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
        }

        function nextPage() {
            const table = document.getElementById('rankingsTable');
            const rows = table.getElementsByTagName('tbody')[0].getElementsByTagName('tr');
            const totalRows = rows.length;
            const totalPages = Math.ceil(totalRows / rowsPerPage);

            if (currentPage < totalPages) {
                currentPage++;
                paginateTable();
            }
        }

        function prevPage() {
            if (currentPage > 1) {
                currentPage--;
                paginateTable();
            }
        }
    </script>
    {% endblock %}
</body>
</html>