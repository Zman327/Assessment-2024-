<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <title>Profile - Fencing Hub</title>
    <link rel="icon" type="image/png" href="Static/Images/Logos/logo.png">
    <link rel="stylesheet" href="/Static/login.css">
    <link rel="stylesheet" href="/Static/styles.css">
</head>
<body>
  <div class="home-button">
    <a href="/home">
        <i class='bx bx-home'></i>
    </a>
  </div>

  <div class="wrapper_profile">
      <form id="profile-form" method="POST" enctype="multipart/form-data">
          <h1>Profile</h1>

          <div class="profile-picture">
            <img src="{{ user_data['profile_pic'] if user_data['profile_pic'] else 'Static/Images/DefaultPP.png' }}" alt="Profile Picture" id="profile-pic">
            <label for="profile-pic-input" class="custom-file-upload">Upload New Picture</label>
            <input type="file" id="profile-pic-input" name="profile-pic" accept="image/*" onchange="previewImage(event)">
        </div>
        
        <div class="input-box">
            <input type="text" id="username" name="username" value="{{ user_data['username'] if user_data['username'] else '' }}" required maxlength="20" oninput="updateCharacterCount('username', 'username-char-count', 20)">
            <p>Username</p>
            <i class='bx bxs-user'></i>
            <span id="username-char-count" class="char-count"></span>
        </div>
        <div class="input-box">
            <input type="email" id="email" name="email" value="{{ user_data['email'] if user_data['email'] else '' }}" required maxlength="30" oninput="updateCharacterCount('email', 'email-char-count', 30)">
            <p>Email</p>
            <i class='bx bx-envelope'></i>
            <span id="email-char-count" class="char-count"></span>
        </div>
        <div class="input-box">
            <input type="tel" id="phone" name="phone" value="{{ user_data['phone'] if user_data['phone'] else '' }}" required maxlength="11" oninput="validatePhoneNumber()">
            <p>Phone</p>
            <i class='bx bx-phone'></i>
        </div>
        <div class="input-box">
            <textarea id="address" name="address" required maxlength="30" >{{ user_data['address'] if user_data['address'] else '' }}</textarea>
            <p>Address</p>
            <i class='bx bx-home'></i>
        </div>
<br>
          <div class="button-container">
              <button type="submit">Save Changes</button>
          </div>

          <div class="profile-link">
              <p><a href="/logout">Logout</a></p>
          </div>
      </form>
  </div>

  <script>
      function previewImage(event) {
          var reader = new FileReader();
          reader.onload = function(){
              var output = document.getElementById('profile-pic');
              output.src = reader.result;
          }
          reader.readAsDataURL(event.target.files[0]);
      }

      function updateCharacterCount(fieldId, countId, maxLength) {
          const field = document.getElementById(fieldId);
          const charCountDisplay = document.getElementById(countId);
          const charCount = field.value.length;

          if (charCount > 0) {
              charCountDisplay.style.display = 'inline';
              charCountDisplay.textContent = `${charCount}/${maxLength}`;
          } else {
              charCountDisplay.style.display = 'none';
          }

          // Change the color of the text if the limit is reached
          if (charCount === maxLength) {
              charCountDisplay.style.color = '#0088a9'; 
          } else {
              charCountDisplay.style.color = '#edf0f1'; // Default color
          }
      }

      document.getElementById('profile-form').onsubmit = function(event) {
          // Add any validation logic if needed
      }

      function validatePhoneNumber() {
        const phoneInput = document.getElementById('phone');
        phoneInput.value = phoneInput.value.replace(/[^0-9]/g, ''); // Allow only numbers
      }

  </script>
</body>
</html>